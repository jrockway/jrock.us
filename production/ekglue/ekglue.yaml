apiVersion: v1alpha
endpoint_config:
    include_not_ready: true
    locality:
        region_from:
            label: failure-domain.beta.kubernetes.io/region
        zone_from:
            use_hostname: true
cluster_config:
    base:
        connect_timeout: 1s
        lb_policy: ROUND_ROBIN
        circuit_breakers: {}
        outlier_detection: {}
        type: EDS
        upstream_connection_options:
            tcp_keepalive: {}
        common_lb_config:
            zone_aware_lb_config:
                routing_enabled:
                    value: 100.0
                min_cluster_size: 1
        eds_cluster_config:
            eds_config:
                api_config_source:
                    api_type: GRPC
                    transport_api_version: V2
                    grpc_services:
                        - envoy_grpc:
                              cluster_name: discovery:ekglue:grpc
    overrides:
        - match:
              - cluster_name: www:www-jrock-us:h2
          override:
              http2_protocol_options: {}
              max_requests_per_connection: 999
              circuit_breakers:
                  thresholds:
                      - retry_budget: {}
                        track_remaining: true
              health_checks:
                  - timeout: 1s
                    interval: 10s
                    healthy_threshold: 1
                    unhealthy_threshold: 2
                    http_health_check:
                        host: "www.jrock.us"
                        path: "/nginx-health-check"
                        codec_client_type: HTTP2
        - match:
              - cluster_name: observability:jaeger-query:http-query
          override:
              health_checks:
                  - timeout: 1s
                    interval: 10s
                    healthy_threshold: 1
                    unhealthy_threshold: 2
                    http_health_check:
                        host: "jaeger.jrock.us"
                        path: "/"
        - match:
              - cluster_name: concourse:concourse-web:atc
          override:
              health_checks:
                  - timeout: 1s
                    interval: 10s
                    healthy_threshold: 1
                    unhealthy_threshold: 2
                    http_health_check:
                        host: "ci.jrock.us"
                        path: "/api/v1/info"
        - match:
              - cluster_name: monitoring:grafana:http
          override:
              health_checks:
                  - timeout: 1s
                    interval: 10s
                    healthy_threshold: 1
                    unhealthy_threshold: 2
                    http_health_check:
                        host: "grafana.jrock.us"
                        path: "/api/health"
        - match:
              - cluster_name: monitoring:prometheus-operated:web
          override:
              health_checks:
                  - timeout: 1s
                    interval: 10s
                    healthy_threshold: 1
                    unhealthy_threshold: 2
                    http_health_check:
                        host: "prom.jrock.us"
                        path: "/-/healthy"
        - match:
              - cluster_name: monitoring:alertmanager-operated:web
          override:
              health_checks:
                  - timeout: 1s
                    interval: 10s
                    healthy_threshold: 1
                    unhealthy_threshold: 2
                    http_health_check:
                        host: "prom.jrock.us"
                        path: "/-/healthy"
